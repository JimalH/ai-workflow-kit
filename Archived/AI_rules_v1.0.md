## 总则

- 先读本文件；不确定就问，不要猜
- 目标：安全、可回滚、改动可追踪（写 log）
- （确认项目使用的conda环境，必须使用conda环境，确认后改写本段），保持base环境干净

## 安全（硬性）

- 机密：不索取/不输出/不复制密钥、token、密码、私钥、证书、隐私与商业机密；若意外看到，停止并提醒用户处理
- 风险操作：不做批量删除/覆盖、重写历史、批量改权限、运行未知脚本、触碰生产环境；必须做则先说明风险并获用户明确确认
- 合规：不协助越权/违法、绕过鉴权、后门/恶意代码、隐蔽外传数据
- 依赖：能不用新依赖就不用；必须新增先说明原因与影响

## Skills（项目级安装 / find-skills）

- 适用：当需要“搜索/安装现成 skills”（例如 find-skills 作为元技能）来辅助完成任务时。
- 默认策略：**优先项目级安装**（落在 repo 的 `.claude/skills/`、`.codex/skills/`），除非用户明确要求全局安装（`-g`）。
- 执行前必须做的确认：

  1) 明确告知：`npx` 会拉取并执行外部代码（供应链风险）；先把将要执行的命令完整展示给用户，并请求确认后再运行。
  2) 询问用户要安装到哪些 agent（例如：`claude-code`、`codex`；可多选）。不确定就问，不要猜。
  3) 不在 conda `base` 环境内安装/修改 Node 相关依赖；若当前系统缺少 `node/npx`，先提示用户并给出“系统 Node / 独立 env”的选项。
- 安装命令模板（项目级）：

  - 两者都装：

    -`npx skills add https://github.com/vercel-labs/skills -s find-skills -a claude-code -a codex -y`
  - 只装到某一个 agent：保留对应的 `-a <agent>` 即可。
- 验证：

  -`npx skills list`（项目级）或 `npx skills list -g`（全局）确认已安装；

  - 确认目录已生成：`.claude/skills/find-skills/`、`.codex/skills/find-skills/`（按所选 agent）。
  - 提醒用户：安装后需要重启对应的 agent 以重新扫描 skills。
- 记录：

  - 在 repo 根目录维护 `.changelog.md`：记录“安装了哪些 skills、对哪些 agent、生效目录、执行命令、验证结果”。

## 变更记录（同目录单文件、最新在最前）

- 文件：`.changelog.md`（同目录只保留一个，持续更新）。
- 位置（按优先级；不确定就问用户）：

  1) 用户指定；2) 主要被修改文件同级；3) 多文件则最近共同目录。
- 更新：把新记录插到文件头部 Header 下方（prepend），不要追加到末尾。
- 验证：validator 只读 Header + 第一条记录。

### .changelog.md 格式

- Header 保持稳定、尽量短；记录边界用 `---`。
- 每条记录模板：

---

时间: [YYYY-MM-DDHH:MM±TZ](YYYY-MM-DDHH:MM%C2%B1TZ)

指令: <用户要点1-2行>

动作: <1-3条>

文件: <路径—关键改动>

验证: <做了什么/无>

风险: <必要才写/N/A>

---

## ROS 文件内的变更记录（当且仅当使用 ROS 执行/验收）

- 若本次实现或验收明确**基于用户提供的 ROS 文件**（按其内容执行需求或做验收），则：

  - 除 `.changelog.md` 外，还必须在该 ROS 文件内记录同样的 changelog。
- 记录方式：

  - ROS 文件末尾保留 `## Change Log` 区块（放在文件最后）。
  - 每次新增记录插入到该区块的最前端（最新在前），旧记录下移。
- ROS 内记录字段沿用同一模板（时间/指令/动作/文件/验证/风险），可更精简。
